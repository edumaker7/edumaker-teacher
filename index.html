<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에듀메이커 강사관리시스템</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }
        .login-container {
            background-color: #ffffff;
            padding: 50px 40px;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.06);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .logo { font-size: 32px; font-weight: 900; color: #0056b3; margin-bottom: 8px; letter-spacing: -1.5px; text-transform: uppercase; }
        .sub-title { font-size: 15px; color: #868e96; margin-bottom: 40px; font-weight: 500; }
        .input-group { text-align: left; margin-bottom: 20px; }
        label { display: block; font-size: 13px; font-weight: 700; color: #495057; margin-bottom: 8px; margin-left: 4px; }
        input { width: 100%; padding: 14px 16px; border: 1px solid #dee2e6; border-radius: 12px; font-size: 15px; box-sizing: border-box; transition: all 0.2s; background-color: #f8f9fa; }
        input:focus { outline: none; border-color: #0056b3; background-color: #fff; box-shadow: 0 0 0 4px rgba(0, 86, 179, 0.1); }
        
        .btn-group { margin-top: 32px; }
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s ease; }
        .btn-login { background-color: #0056b3; color: white; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0, 86, 179, 0.2); }
        .btn-login:hover { background-color: #004494; transform: translateY(-1px); }
        .btn-signup { background-color: transparent; color: #495057; border: 1px solid #dee2e6; font-size: 14px; margin-bottom: 16px; }
        .btn-signup:hover { background-color: #f1f3f5; }
        
        /* 계정 찾기 링크 스타일 (회원가입 버튼 아래 배치) */
        .find-links { margin-top: 20px; font-size: 13px; color: #adb5bd; }
        .find-links a { cursor: pointer; text-decoration: none; color: #adb5bd; margin: 0 10px; transition: 0.2s; }
        .find-links a:hover { color: #868e96; text-decoration: underline; }

        .btn-admin-mode { background-color: transparent; color: #ced4da; font-size: 11px; font-weight: 400; text-decoration: underline; border: none; padding: 5px; margin-top: 15px; }
        .btn-admin-mode:hover { color: #adb5bd; }
        
        .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #999; line-height: 1.8; }
        .footer a { color: #888; text-decoration: none; margin: 0 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="login-container">
        <div class="logo">EDUMAKER</div>
        <div class="sub-title">강사 전용 관리 시스템</div>

        <div class="input-group">
            <label for="email">이메일 주소</label>
            <input type="email" id="email" placeholder="이메일을 입력하세요">
        </div>

        <div class="input-group">
            <label for="password">비밀번호</label>
            <input type="password" id="password" placeholder="비밀번호를 입력하세요">
        </div>

        <div class="btn-group">
            <button class="btn-login" id="loginBtn">강사 로그인</button>
            <button class="btn-signup" id="signupBtn">신규 강사 회원가입</button>
            
            <div class="find-links">
                <a id="findIdBtn">아이디 찾기</a>
                <span style="color:#eee">|</span>
                <a id="findPwBtn">비밀번호 찾기</a>
            </div>

            <button class="btn-admin-mode" id="adminBtn">관리자 모드 접속</button>
        </div>
    </div>

    <div class="footer">
        <div class="footer-links">
            <a onclick="openPrivacyPopup()">개인정보처리방침</a>
            <span class="footer-divider">|</span>
            <a href="mailto:edumaker08@gmail.com">이메일 문의</a>
            <span class="footer-divider">|</span>
            <a href="http://pf.kakao.com/_xhSsRb" target="_blank">카카오톡 채널</a>
        </div>
        <div class="copyright">
            © 2026 EDUMAKER. All Rights Reserved.
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDKA0GjAlOF826TZl49y67H4oz8nMW_Jbw",
            authDomain: "edumaker-teacher-d97ba.firebaseapp.com",
            projectId: "edumaker-teacher-d97ba",
            storageBucket: "edumaker-teacher-d97ba.firebasestorage.app",
            messagingSenderId: "532708143359",
            appId: "1:532708143359:web:89b9933da4c868127ddcca",
            measurementId: "G-JJ1TF77VBJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 핸드폰 번호 포맷팅 (010-XXXX-XXXX)
        function formatPhoneNumber(input) {
            const pure = input.replace(/[^0-9]/g, '');
            if (pure.length === 11) {
                return pure.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
            }
            return input;
        }

        // 1. 아이디 찾기
        document.getElementById('findIdBtn').addEventListener('click', async () => {
            const name = prompt("가입하신 성함을 입력하세요.");
            let phone = prompt("가입하신 핸드폰 번호를 입력하세요.");
            if (!name || !phone) return;

            phone = formatPhoneNumber(phone);

            try {
                const q = query(collection(db, "users"), where("name", "==", name), where("phone", "==", phone));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    alert("일치하는 정보가 없습니다.");
                } else {
                    let emails = [];
                    querySnapshot.forEach(doc => emails.push(doc.data().email));
                    alert(`${name} 강사님의 아이디는\n[ ${emails.join(", ")} ] 입니다.`);
                }
            } catch (e) { alert("조회 중 오류가 발생했습니다."); }
        });

        // 2. 비밀번호 찾기 (본인인증 후 메일 발송)
        document.getElementById('findPwBtn').addEventListener('click', async () => {
            const email = prompt("비밀번호를 재설정할 이메일을 입력하세요.");
            const name = prompt("가입하신 성함을 입력하세요.");
            let phone = prompt("가입하신 핸드폰 번호를 입력하세요.");
            if (!email || !name || !phone) return;

            phone = formatPhoneNumber(phone);

            try {
                const q = query(collection(db, "users"), 
                            where("email", "==", email), 
                            where("name", "==", name), 
                            where("phone", "==", phone));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    alert("정보가 일치하지 않습니다. 본인 확인에 실패했습니다.");
                } else {
                    await sendPasswordResetEmail(auth, email);
                    alert("본인 확인 완료!\n" + email + " 주소로 재설정 메일을 보내드렸습니다. 메일함의 링크를 확인해 주세요.");
                }
            } catch (e) { alert("오류가 발생했습니다: " + e.message); }
        });

        // 로그인
        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const pw = document.getElementById('password').value;
            if(!email || !pw) { alert("정보를 입력해주세요."); return; }
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, pw);
                window.location.href = (userCredential.user.email === "help@edumaker.kr") ? "admin.html" : "teacher_main.html";
            } catch (error) { alert("로그인 실패. 정보를 확인하세요."); }
        });

        // 관리자 모드
        document.getElementById('adminBtn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const pw = document.getElementById('password').value;
            if (email === "help@edumaker.kr" && pw === "123456") {
                try {
                    await signInWithEmailAndPassword(auth, email, pw);
                    alert("관리자 권한으로 접속합니다.");
                    window.location.href = "admin.html";
                } catch (error) { alert("인증 오류가 발생했습니다."); }
            } else { alert("관리자 계정 정보가 일치하지 않습니다."); }
        });

        document.getElementById('signupBtn').addEventListener('click', () => { window.location.href = 'signup.html'; });

        window.openPrivacyPopup = function() {
            const width = 600, height = 800;
            const left = (window.screen.width / 2) - (width / 2);
            const top = (window.screen.height / 2) - (height / 2);
            window.open('privacy.html', 'PrivacyPolicy', `width=${width},height=${height},left=${left},top=${top},scrollbars=yes,resizable=yes`);
        }
    </script>
</body>
</html>