<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—ë“€ë©”ì´ì»¤ - ê°•ì‚¬ ëª…ë‹¨ ê´€ë¦¬</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f4f7f9; padding: 40px; margin: 0; color: #333; }
        .container { background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #f1f3f5; padding-bottom: 20px; }
        .logo { font-size: 24px; font-weight: 800; color: #0056b3; cursor: pointer; text-decoration: none; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 16px; text-align: left; border-bottom: 1px solid #eee; font-size: 14px; }
        th { background-color: #fcfcfc; color: #555; font-weight: 700; }
        tr:hover { background-color: #f9fbff; }

        .col-num { width: 60px; text-align: center; color: #999; }
        .col-date { width: 130px; color: #666; }
        .btn-delete {
            background-color: #fff1f0; color: #ff4d4f; border: 1px solid #ffccc7; padding: 7px 14px;
            border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;
        }
        .btn-delete:hover { background-color: #ff4d4f; color: white; }
        .btn-back { background-color: #0056b3; color: white; text-decoration: none; padding: 10px 22px; border-radius: 8px; font-size: 14px; font-weight: 600; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <a href="admin.html" class="logo">EDUMAKER ADMIN</a>
        <h2 style="margin:0;">ğŸ“‹ ê°•ì‚¬ í†µí•© ëª…ë‹¨</h2>
        <a href="admin.html" class="btn-back">ê´€ë¦¬ì í™ˆìœ¼ë¡œ</a>
    </div>

    <table>
        <thead>
            <tr>
                <th class="col-num">ë²ˆí˜¸</th>
                <th class="col-date">ê°€ì…ë‚ ì§œ</th>
                <th>ì´ë¦„</th>
                <th>ì „í™”ë²ˆí˜¸</th>
                <th>ì´ë©”ì¼ì£¼ì†Œ(ì•„ì´ë””)</th>
                <th>í™œë™ì§€ì—­</th>
                <th style="text-align: center;">ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody id="teacherTableBody">
            <tr><td colspan="7" style="text-align:center; padding:50px; color:#999;">ë°ì´í„°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td></tr>
        </tbody>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDKA0GjAlOF826TZl49y67H4oz8nMW_Jbw",
        authDomain: "edumaker-teacher-d97ba.firebaseapp.com",
        projectId: "edumaker-teacher-d97ba",
        storageBucket: "edumaker-teacher-d97ba.firebasestorage.app",
        messagingSenderId: "532708143359",
        appId: "1:532708143359:web:89b9933da4c868127ddcca",
        measurementId: "G-JJ1TF77VBJ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // [ë‚ ì§œ ë³€í™˜ í•¨ìˆ˜] í•œê¸€ ê¹¨ì§ ë°©ì§€ìš© ì•ˆì „ ì¥ì¹˜ í¬í•¨
    function formatDate(timestamp) {
        if (!timestamp) return "-";
        try {
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        } catch (e) { return "-"; }
    }

    const teacherTableBody = document.getElementById('teacherTableBody');

    // [í•µì‹¬ ë°ì´í„° ë¡œë“œ ë¡œì§]
    // 'users' ì»¬ë ‰ì…˜ì—ì„œ 'createdAt' í•„ë“œ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const q = query(collection(db, "users"), orderBy("createdAt", "desc"));

    onSnapshot(q, (snapshot) => {
        teacherTableBody.innerHTML = '';
        let num = 1;

        if (snapshot.empty) {
            teacherTableBody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding:50px;">ë“±ë¡ëœ ê°•ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            return;
        }

        snapshot.forEach((docSnap) => {
            const data = docSnap.data();
            if (data.email === "help@edumaker.kr") return;

            /* [ë°ì´í„°ë² ì´ìŠ¤ í•„ë“œ í˜¸ì¶œ ì•ˆë‚´ - Firestore 'users' ì»¬ë ‰ì…˜]
               DBì—ì„œ ë°ì´í„°ë¥¼ êº¼ë‚´ì˜¬ ë•Œ ì‚¬ìš©í•˜ëŠ” í•„ë“œëª…(Key) ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.
               - data.createdAt    : ê°€ì… ë‚ ì§œ (formatDate í•¨ìˆ˜ë¥¼ í†µí•´ ë³€í™˜)
               - data.name         : ê°•ì‚¬ ì„±í•¨
               - data.phone        : ì—°ë½ì²˜
               - data.email        : ê°•ì‚¬ ì´ë©”ì¼ (ê³„ì • ì•„ì´ë””)
               - data.region       : í™œë™ ì§€ì—­
            */

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="col-num">${num++}</td>
                <td class="col-date">${formatDate(data.createdAt)}</td> <td style="font-weight:700;">${String(data.name || '-')}</td> <td>${String(data.phone || '-')}</td>                          <td>${String(data.email || '-')}</td>                          <td>${String(data.region || '-')}</td>                         <td style="text-align: center;">
                    <button class="btn-delete" onclick="deleteTeacher('${docSnap.id}', '${data.name}')">ì‚­ì œ</button>
                </td>
            `;
            teacherTableBody.appendChild(tr);
        });
    });

    window.deleteTeacher = async function(id, name) {
        if (confirm(`'${name}' ê°•ì‚¬ë‹˜ì˜ ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            try {
                await deleteDoc(doc(db, "users", id));
                alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            } catch (error) { alert("ì‚­ì œ ì‹¤íŒ¨"); }
        }
    }
</script>
</body>
</html>